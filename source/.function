#!/bin/bash

ecs_exec() {
  if [ -z "$1" ]; then
    echo "Missing ECS name"
    return 1
  fi

  local ecs_name="$1"

  if [ -n "$2" ]; then
    export AWS_REGION="$2"
  fi

  aws ecs execute-command --region "$AWS_REGION" --cluster "$ecs_name" \
    --task "$(aws ecs list-tasks --cluster "$ecs_name" --service-name "$ecs_name" \
      --output text --query 'taskArns[0]')" --container "$ecs_name" --command "/bin/bash" --interactive
}

_fzf_compgen_path() {
  fdfind --hidden --follow --exclude ".git" . "$1"
}

_fzf_compgen_dir() {
  fdfind --type d --hidden --follow --exclude ".git" . "$1"
}

_fzf_comprun() {
  local command=$1
  shift

  case "$command" in
    cd)           fzf --preview 'eza --tree --color=always {} | head -200' "$@" ;;
    export|unset) fzf --preview "eval 'echo ${}'"         "$@" ;;
    ssh)          fzf --preview 'dig {}'                   "$@" ;;
    *)            fzf --preview "$show_file_or_dir_preview" "$@" ;;
  esac
}
